import ChatList from "./screens/chat/ChatList";
import React, { useMemo, useState } from "react";
import api from "../api/api";
import { IoMoonOutline, IoSunnyOutline } from "react-icons/io5";
import { Link } from "react-router-dom";
import { motion as m } from "framer-motion";

import "../styles/Main.css";
const ChatForm = React.lazy(() => import("./screens/chat/ChatForm"));

export default function Main() {
  const sendLogout = async () => {
    try {
      await api.userLogout();
    } catch (error) {
      alert(error.message);
    }
    localStorage.removeItem("sessionId");
  };

  const [currentTheme, setCurrentTheme] = useState(
    localStorage.getItem("theme")
  );
  const changeToDarkTheme = () => {
    localStorage.setItem("theme", "dark");
    document.body.classList.add("dark-theme");
    setCurrentTheme("dark");
  };
  const changeToLightTheme = () => {
    localStorage.setItem("theme", "light");
    document.body.classList.remove("dark-theme");
    setCurrentTheme("light");
  };

  const changeThemeBtn = useMemo(() => {
    return currentTheme === "dark" ? (
      <div className="change-themes" onClick={changeToLightTheme}>
        <svg
          width="36"
          height="36"
          viewBox="0 0 36 36"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M10.5754 10.5754C12.5445 8.60625 15.2152 7.5 18 7.5C20.7848 7.5 23.4555 8.60625 25.4246 10.5754C27.3938 12.5445 28.5 15.2152 28.5 18C28.5 20.7848 27.3938 23.4555 25.4246 25.4246C23.4555 27.3938 20.7848 28.5 18 28.5C15.2152 28.5 12.5445 27.3938 10.5754 25.4246C8.60625 23.4555 7.5 20.7848 7.5 18C7.5 15.2152 8.60625 12.5445 10.5754 10.5754ZM18 9C15.6131 9 13.3239 9.94821 11.636 11.636C9.94821 13.3239 9 15.6131 9 18C9 20.3869 9.94821 22.6761 11.636 24.364C13.3239 26.0518 15.6131 27 18 27C20.3869 27 22.6761 26.0518 24.364 24.364C26.0518 22.6761 27 20.3869 27 18C27 15.6131 26.0518 13.3239 24.364 11.636C22.6761 9.94821 20.3869 9 18 9Z"
            fill="white"
          />
          <path
            d="M18 2C18.5523 2 19 2.44772 19 3V3.12C19 3.67228 18.5523 4.12 18 4.12C17.4477 4.12 17 3.67228 17 3.12V3C17 2.44772 17.4477 2 18 2ZM6.58289 6.58289C6.97342 6.19237 7.60658 6.19237 7.99711 6.58289L8.19211 6.77789C8.58263 7.16842 8.58263 7.80158 8.19211 8.19211C7.80158 8.58263 7.16842 8.58263 6.77789 8.19211L6.58289 7.99711C6.19237 7.60658 6.19237 6.97342 6.58289 6.58289ZM29.4171 6.58289C29.8076 6.97342 29.8076 7.60658 29.4171 7.99711L29.2221 8.19211C28.8316 8.58263 28.1984 8.58263 27.8079 8.19211C27.4174 7.80158 27.4174 7.16842 27.8079 6.77789L28.0029 6.58289C28.3934 6.19237 29.0266 6.19237 29.4171 6.58289ZM2 18C2 17.4477 2.44772 17 3 17H3.12C3.67228 17 4.12 17.4477 4.12 18C4.12 18.5523 3.67228 19 3.12 19H3C2.44772 19 2 18.5523 2 18ZM31.88 18C31.88 17.4477 32.3277 17 32.88 17H33C33.5523 17 34 17.4477 34 18C34 18.5523 33.5523 19 33 19H32.88C32.3277 19 31.88 18.5523 31.88 18ZM8.19211 27.8079C8.58263 28.1984 8.58263 28.8316 8.19211 29.2221L7.99711 29.4171C7.60658 29.8076 6.97342 29.8076 6.58289 29.4171C6.19237 29.0266 6.19237 28.3934 6.5829 28.0029L6.77789 27.8079C7.16842 27.4174 7.80159 27.4174 8.19211 27.8079ZM27.8079 27.8079C28.1984 27.4174 28.8316 27.4174 29.2221 27.8079L29.4171 28.0029C29.8076 28.3934 29.8076 29.0266 29.4171 29.4171C29.0266 29.8076 28.3934 29.8076 28.0029 29.4171L27.8079 29.2221C27.4174 28.8316 27.4174 28.1984 27.8079 27.8079ZM18 31.88C18.5523 31.88 19 32.3277 19 32.88V33C19 33.5523 18.5523 34 18 34C17.4477 34 17 33.5523 17 33V32.88C17 32.3277 17.4477 31.88 18 31.88Z"
            fill="white"
          />
        </svg>
      </div>
    ) : (
      <div className="change-themes" onClick={changeToDarkTheme}>
        <svg
          width="36"
          height="36"
          viewBox="0 0 36 36"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M14.9244 2.90006C15.5488 3.48717 15.4761 4.46407 15.0535 5.43458L15.0531 5.43536C14.3453 7.0533 13.9556 8.82887 13.97 10.7061L13.9701 10.7079C13.9989 17.6792 19.7813 23.601 26.8555 23.8904L26.8559 23.8904C27.8986 23.9338 28.8967 23.8615 29.8659 23.688C30.4213 23.5867 30.9211 23.5778 31.3406 23.6757C31.7645 23.7745 32.1341 23.9909 32.3561 24.3542C32.5775 24.7165 32.6026 25.1438 32.5024 25.5654C32.403 25.9835 32.1753 26.4259 31.843 26.876C28.7769 31.0718 23.6694 33.7319 17.9634 33.4845L17.9631 33.4845C9.87094 33.1286 3.10478 26.6502 2.54631 18.6654C2.03516 11.5832 6.23649 5.40695 12.3608 2.82424C13.3346 2.41152 14.3156 2.32753 14.9244 2.90006ZM14.2394 3.62858C14.0947 3.49254 13.6511 3.36333 12.7502 3.74528L12.7493 3.74566C6.99378 6.17287 3.06518 11.9663 3.54376 18.5939L3.54384 18.5951C4.06565 26.06 10.4094 32.1513 18.007 32.4854C23.3704 32.7179 28.1624 30.2185 31.0363 26.285L31.0379 26.2829C31.3201 25.9008 31.4709 25.5804 31.5295 25.3342C31.5872 25.0911 31.5495 24.9522 31.5028 24.8757C31.4567 24.8002 31.3528 24.7054 31.1134 24.6495C30.8698 24.5927 30.5166 24.5857 30.0448 24.6718L30.0432 24.6721C29.0028 24.8585 27.9314 24.936 26.8146 24.8895C19.2191 24.5789 13.0017 18.2312 12.9701 10.7129C12.9546 8.69059 13.3749 6.77657 14.1368 5.03485C14.5239 4.14569 14.3688 3.75021 14.2394 3.62858Z"
            fill="white"
          />
        </svg>
      </div>
    );
  }, [currentTheme]);

  return (
    <div>
      <nav>
        <div className="nav-logo">
          <svg
            width="50"
            height="48"
            viewBox="0 0 50 48"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M13.951 12.75C13.434 12.75 12.953 12.7695 12.5006 12.8245C12.4912 12.8257 12.4817 12.8266 12.4723 12.8274C9.83973 13.0465 7.97164 13.9018 6.75193 15.2984C5.52652 16.7014 4.85929 18.7606 4.85929 21.58V29.58C4.85929 33.5106 5.67268 35.621 7.05804 36.7985C8.47507 38.003 10.6839 38.41 13.951 38.41H14.7729C14.789 38.41 14.805 38.4105 14.8211 38.4116C15.1697 38.434 15.5109 38.5239 15.8248 38.6767C16.1388 38.8295 16.4196 39.0424 16.6503 39.3038C16.6613 39.3163 16.6718 39.3291 16.682 39.3422L19.1486 42.5436C19.5706 43.094 20.0754 43.315 20.5259 43.315C20.9764 43.315 21.4812 43.094 21.9032 42.5436L21.9043 42.5422L24.3698 39.3422C24.8229 38.7543 25.5373 38.41 26.2789 38.41H27.1008C30.01 38.41 32.1368 37.7615 33.5832 36.5668C35.0165 35.3829 35.8893 33.5731 36.1132 31.0146C36.1141 31.0045 36.1151 30.9945 36.1164 30.9845C36.1726 30.5474 36.1925 30.0819 36.1925 29.58V21.58C36.1925 18.5114 35.4032 16.3433 33.9564 14.9349C32.5058 13.5229 30.2667 12.75 27.1008 12.75H13.951ZM12.3338 11.3338C12.8631 11.2702 13.4046 11.25 13.951 11.25H27.1008C30.4891 11.25 33.1709 12.0771 35.0026 13.8601C36.8381 15.6467 37.6925 18.2686 37.6925 21.58V29.58C37.6925 30.1129 37.6718 30.6422 37.6062 31.1603C37.3553 33.9948 36.3586 36.2198 34.5385 37.7232C32.7283 39.2185 30.2116 39.91 27.1008 39.91H26.2789C25.9932 39.91 25.7214 40.0457 25.558 40.2578L23.0935 43.4564C23.0933 43.4566 23.0937 43.4562 23.0935 43.4564C22.4266 44.3256 21.5032 44.815 20.5259 44.815C19.5486 44.815 18.6257 44.3263 17.9588 43.4571C17.9587 43.4569 17.959 43.4573 17.9588 43.4571L15.5109 40.28C15.4153 40.1759 15.2993 40.0892 15.1684 40.0254C15.037 39.9615 14.8936 39.9221 14.7459 39.91H13.951C10.6638 39.91 7.95182 39.527 6.08655 37.9415C4.18961 36.329 3.35929 33.6494 3.35929 29.58V21.58C3.35929 18.5394 4.07895 16.0786 5.62216 14.3116C7.16858 12.541 9.44597 11.5766 12.3338 11.3338Z"
              fill="white"
            />
            <path
              d="M13.2652 11.2624C13.4926 11.2536 13.7214 11.25 13.951 11.25H27.1008C30.4891 11.25 33.1709 12.0771 35.0026 13.8601C36.8381 15.6467 37.6925 18.2686 37.6925 21.58V29.58C37.6925 29.7979 37.689 30.0153 37.6805 30.2315C39.8548 29.9095 41.4405 29.1014 42.5188 27.8687C43.7436 26.4686 44.4111 24.41 44.4111 21.58V13.58C44.4111 10.5114 43.6218 8.34329 42.175 6.93493C40.7244 5.52294 38.4853 4.75 35.3193 4.75H22.1696C19.2616 4.75 17.1346 5.40294 15.6877 6.60031C14.4251 7.64512 13.5978 9.17328 13.2652 11.2624ZM14.7313 5.44469C16.5411 3.94706 19.0575 3.25 22.1696 3.25H35.3193C38.7077 3.25 41.3895 4.07706 43.2212 5.86007C45.0567 7.64671 45.9111 10.2686 45.9111 13.58V21.58C45.9111 24.63 45.1917 27.0914 43.6478 28.8563C42.0984 30.6276 39.8157 31.5866 36.9225 31.8274C36.6969 31.8462 36.4748 31.762 36.3183 31.5984C36.1618 31.4347 36.0876 31.2091 36.1164 30.9845C36.1726 30.5474 36.1925 30.0819 36.1925 29.58V21.58C36.1925 18.5114 35.4032 16.3433 33.9564 14.9349C32.5058 13.5229 30.2667 12.75 27.1008 12.75H13.951C13.434 12.75 12.953 12.7695 12.5006 12.8245C12.2761 12.8518 12.0513 12.7764 11.8887 12.6191C11.7261 12.4619 11.6431 12.2397 11.6629 12.0144C11.9117 9.18235 12.9089 6.95286 14.7313 5.44469Z"
              fill="white"
            />
            <path
              d="M12.3449 26.5C12.3449 25.9477 12.7926 25.5 13.3449 25.5H13.3655C13.9177 25.5 14.3655 25.9477 14.3655 26.5C14.3655 27.0523 13.9177 27.5 13.3655 27.5H13.3449C12.7926 27.5 12.3449 27.0523 12.3449 26.5ZM19.5362 26.5C19.5362 25.9477 19.9839 25.5 20.5362 25.5H20.5567C21.109 25.5 21.5567 25.9477 21.5567 26.5C21.5567 27.0523 21.109 27.5 20.5567 27.5H20.5362C19.9839 27.5 19.5362 27.0523 19.5362 26.5ZM26.7274 26.5C26.7274 25.9477 27.1751 25.5 27.7274 25.5H27.748C28.3003 25.5 28.748 25.9477 28.748 26.5C28.748 27.0523 28.3003 27.5 27.748 27.5H27.7274C27.1751 27.5 26.7274 27.0523 26.7274 26.5Z"
              fill="white"
            />
          </svg>
          <p>SAMA</p>
        </div>
        <div className="nav-navigate-bar">
          {changeThemeBtn}
          <div className="nav-navigate-slice">
            <span>|</span>
          </div>
          <div className="nav-logout-btn">
            <Link to={"/login"} onClick={sendLogout} className="logout-btn">
              Logout
            </Link>
          </div>
        </div>
      </nav>
      <main>
        <ChatList />
        <ChatForm />
      </main>
    </div>
  );
}
